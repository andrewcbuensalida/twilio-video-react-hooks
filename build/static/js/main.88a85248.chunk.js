(this["webpackJsonpreact-express-starter"]=this["webpackJsonpreact-express-starter"]||[]).push([[0],{200:function(e,t,n){},202:function(e,t,n){"use strict";n.r(t);var c=n(3),r=n(80),a=n.n(r),i=(n(86),n(20)),o=n.n(i),s=n(33),u=n(7),d=n(81),l=n.n(d),j=(n(200),n(0)),f=function(e){var t=e.username,n=e.handleUsernameChange,c=e.roomName,r=e.handleRoomNameChange,a=e.handleSubmit,i=e.connecting,o=e.roomOptions;return Object(j.jsxs)("form",{onSubmit:a,children:[Object(j.jsx)("h2",{children:"Enter a room"}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{htmlFor:"name",children:"Username:"}),Object(j.jsx)("input",{type:"text",id:"field",value:t,onChange:n,readOnly:i,required:!0})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("label",{htmlFor:"room",children:"Room name:"}),Object(j.jsx)("select",{id:"room",className:"Lobby_select",value:c,onChange:r,readOnly:i,required:!0,children:o.map((function(e){return Object(j.jsx)("option",{value:e.name,children:e.name},e.id)}))})]}),Object(j.jsx)("button",{type:"submit",disabled:i,children:i?"Connecting":"Join"})]})},b=n(19),h=function(e){var t=e.participant,n=Object(c.useState)([]),r=Object(u.a)(n,2),a=r[0],i=r[1],o=Object(c.useState)([]),s=Object(u.a)(o,2),d=s[0],l=s[1],f=Object(c.useRef)(),h=Object(c.useRef)(),m=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};return Object(c.useEffect)((function(){i(m(t.videoTracks)),l(m(t.audioTracks));return t.on("trackSubscribed",(function(e){"video"===e.kind?i((function(t){return[].concat(Object(b.a)(t),[e])})):"audio"===e.kind&&l((function(t){return[].concat(Object(b.a)(t),[e])}))})),t.on("trackUnsubscribed",(function(e){"video"===e.kind?i((function(t){return t.filter((function(t){return t!==e}))})):"audio"===e.kind&&l((function(t){return t.filter((function(t){return t!==e}))}))})),function(){i([]),l([]),t.removeAllListeners()}}),[t]),Object(c.useEffect)((function(){var e=a[0];if(e)return e.attach(f.current),function(){e.detach()}}),[a]),Object(c.useEffect)((function(){var e=d[0];if(e)return e.attach(h.current),function(){e.detach()}}),[d]),Object(j.jsxs)("div",{className:"participant",children:[Object(j.jsx)("h3",{children:t.identity}),Object(j.jsx)("video",{ref:f,autoPlay:!0}),Object(j.jsx)("audio",{ref:h,autoPlay:!0,muted:!0})]})},m=function(e){var t=e.roomName,n=e.room,r=e.handleLogout,a=Object(c.useState)([]),i=Object(u.a)(a,2),o=i[0],s=i[1];return Object(c.useEffect)((function(){var e=function(e){s((function(t){return[].concat(Object(b.a)(t),[e])}))},t=function(e){s((function(t){return t.filter((function(t){return t!==e}))}))};return n.on("participantConnected",e),n.on("participantDisconnected",t),n.participants.forEach(e),function(){n.off("participantConnected",e),n.off("participantDisconnected",t)}}),[n]),Object(j.jsxs)("div",{className:"room",children:[Object(j.jsxs)("h2",{children:["Room: ",t]}),Object(j.jsx)("button",{onClick:r,children:"Log out"}),Object(j.jsx)("div",{className:"local-participant",children:n?Object(j.jsx)(h,{participant:n.localParticipant},n.localParticipant.sid):""}),Object(j.jsx)("h3",{children:"Remote Participants"}),Object(j.jsx)("div",{className:"remote-participants",children:o.map((function(e){return Object(j.jsx)(h,{participant:e},e.sid)}))})]})},p=function(){var e=Object(c.useState)(""),t=Object(u.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(""),i=Object(u.a)(a,2),d=i[0],b=i[1],h=Object(c.useState)(null),p=Object(u.a)(h,2),O=p[0],v=p[1],x=Object(c.useState)(!1),w=Object(u.a)(x,2),g=w[0],k=w[1],y=Object(c.useState)([]),E=Object(u.a)(y,2),N=E[0],S=E[1],C=function(){var e=Object(s.a)(o.a.mark((function e(t){var c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),k(!0),e.next=4,fetch("".concat("","?identity=").concat(n,"&room=").concat(d)).then((function(e){return e.json()}));case 4:c=e.sent,l.a.connect(c.accessToken,{name:d,video:!0,audio:!0}).then((function(e){k(!1),v(e)})).catch((function(e){console.error(e),k(!1)}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){v((function(e){return e&&(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),e.disconnect()),null}))};return Object(c.useEffect)((function(){function e(){return(e=Object(s.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S([{id:1,name:"Loading..."}]),e.next=3,fetch("".concat("","/roomOptions"));case 3:return t=e.sent,e.next=6,t.json();case 6:n=e.sent,S(n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}if(function(){e.apply(this,arguments)}(),O){var t=function(e){e.persisted||O&&L()};return window.addEventListener("pagehide",t),window.addEventListener("beforeunload",t),function(){window.removeEventListener("pagehide",t),window.removeEventListener("beforeunload",t)}}}),[O]),O?Object(j.jsx)(m,{roomName:d,room:O,handleLogout:L}):Object(j.jsx)(f,{username:n,roomName:d,handleUsernameChange:function(e){r(e.target.value)},handleRoomNameChange:function(e){b(e.target.value)},handleSubmit:C,connecting:g,roomOptions:N})},O=function(){return Object(j.jsxs)("div",{className:"app",children:[Object(j.jsx)("header",{children:Object(j.jsx)("h1",{children:"Video Chat with Hooks"})}),Object(j.jsx)("main",{children:Object(j.jsx)(p,{})}),Object(j.jsx)("footer",{children:Object(j.jsxs)("p",{children:["Made with"," ",Object(j.jsx)("span",{role:"img","aria-label":"React",children:"\u269b\ufe0f"})," ","by ",Object(j.jsx)("a",{href:"https://twitter.com/philnash",children:"philnash"})]})})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(j.jsx)(O,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},86:function(e,t,n){}},[[202,1,2]]]);
//# sourceMappingURL=main.88a85248.chunk.js.map